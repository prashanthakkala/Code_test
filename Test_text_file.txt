import pdfplumber

def process_pdf(pdf_path):
    results = []

    with pdfplumber.open(pdf_path) as pdf:
        for page_number, page in enumerate(pdf.pages, start=1):
            lines = page.lines
            tables = page.extract_tables()
            page_text = page.extract_text()

            if tables:
                for table_number, table in enumerate(tables, start=1):
                    table_data = {
                        "page_number": page_number,
                        "table_number": table_number,
                        "table_content": table,
                        "missing_horizontal_line": False,
                        "text_after_table": ""
                    }

                    # Determine Y-coordinate of the last row in the table
                    last_row_y = max([float(cell.get("y1", 0)) for row in table for cell in row if isinstance(cell, dict)], default=None)
                    
                    # Check if the end horizontal line is missing
                    horizontal_lines = [line for line in lines if abs(line['top'] - last_row_y) < 2]  # Allowing small margin for floating point precision

                    if not horizontal_lines:
                        table_data["missing_horizontal_line"] = True

                    # Extract the text after the table
                    if last_row_y:
                        text_after_table = ""
                        for char in page.chars:
                            if char['top'] > last_row_y:
                                text_after_table += char['text']

                        table_data["text_after_table"] = text_after_table.strip()

                    # Add the result to the list
                    results.append(table_data)

    return results

# Example usage
pdf_path = 'your_pdf.pdf'
results = process_pdf(pdf_path)

for result in results:
    print(f"Page {result['page_number']}, Table {result['table_number']}:")
    if result['missing_horizontal_line']:
        print("  - Missing horizontal line after the table")
    print(f"  - Text after table: '{result['text_after_table']}'")
