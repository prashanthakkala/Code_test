import pdfplumber
import pandas as pd

def extract_tables_with_bottom_check(pdf_path):
    tables_list = []

    with pdfplumber.open(pdf_path) as pdf:
        for page_num, page in enumerate(pdf.pages):
            # Extract tables using pdfplumber
            tables = page.extract_tables()
            page_height = page.height
            
            # Extract text from the bottom 50 pixels of the page
            last_row_bbox = (0, page_height - 50, page.width, page_height)
            last_row_text = page.within_bbox(last_row_bbox).extract_text()
            last_row = last_row_text.split() if last_row_text else []

            for table in tables:
                # Convert table to DataFrame
                df = pd.DataFrame(table)
                # Add page number to the DataFrame
                df['Page'] = page_num + 1

                # Check if the last row content is missing and append it if necessary
                if last_row and not any(last_row == df.iloc[-1].tolist()[:len(last_row)]):
                    # Ensure last_row matches the table's number of columns
                    if len(last_row) == df.shape[1] - 1:  # Minus 1 for the 'Page' column
                        last_row.append(page_num + 1)  # Add the page number to the last row
                        df = df.append(pd.Series(last_row, index=df.columns), ignore_index=True)
                
                tables_list.append(df)

    # Combine all DataFrames into one
    final_df = pd.concat(tables_list, ignore_index=True)
    return final_df

# Usage
pdf_path = "your_pdf_file.pdf"
tables_df = extract_tables_with_bottom_check(pdf_path)

# Display the combined DataFrame
print(tables_df)
